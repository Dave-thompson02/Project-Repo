apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: reservation-app
data:
  reservation-app.json: |
    {
      "id": null,
      "uid": "resv-app",
      "title": "Reservation App â€” Basics",
      "timezone": "browser",
      "schemaVersion": 39,
      "version": 1,
      "panels": [
        { "type":"timeseries","title":"Availability (up)","id":1,
          "targets":[{"expr":"up"}] },
        { "type":"timeseries","title":"RPS (1m)","id":2,
          "targets":[{"expr":"sum(rate(http_request_duration_seconds_count[1m]))"}] },
        { "type":"timeseries","title":"Error ratio (5m)","id":3,
          "targets":[{"expr":"sum(rate(http_request_duration_seconds_count{status_code=~\"5..\"}[5m])) / sum(rate(http_request_duration_seconds_count[5m]))"}] },
        { "type":"timeseries","title":"Latency p95 (5m)","id":4,
          "targets":[{"expr":"histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))"}] }
      ]
    }
